# Android BLE开发框架

## 推荐一款工具箱【蜗牛工具箱】APP，涵盖广，功能丰富。生活实用、效率办公、图片处理等等，还有隐藏的VIP功能，总之很多惊喜的功能。

<div align="center">
    <img src="https://appimg.dbankcdn.com/application/screenshut1/b894e330ffe84787ad617071e2739cc7.jpg" width=150>
    <img src="https://appimg.dbankcdn.com/application/screenshut2/b894e330ffe84787ad617071e2739cc7.jpg" width=150>
    <img src="https://appimg.dbankcdn.com/application/screenshut3/b894e330ffe84787ad617071e2739cc7.jpg" width=150>
    <img src="https://appimg.dbankcdn.com/application/screenshut4/b894e330ffe84787ad617071e2739cc7.jpg" width=150>
</div>

点击下方按钮或扫码下载【蜗牛工具箱】

[![](https://img.shields.io/badge/下载-%E8%9C%97%E7%89%9B%E5%B7%A5%E5%85%B7%E7%AE%B1-red)](https://appgallery1.huawei.com/#/app/C109066561)

![image](data:image/png;base64,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)

## 最新版本

[![Maven Central](https://maven-badges.herokuapp.com/maven-central/cn.wandersnail/easyble-x/badge.svg)](https://maven-badges.herokuapp.com/maven-central/cn.wandersnail/easyble-x)
[![Release](https://jitpack.io/v/cn.wandersnail/easyble-x.svg)](https://jitpack.io/#cn.wandersnail/easyble-x)
[![](https://img.shields.io/badge/源码-github-blue.svg)](https://github.com/wandersnail/easyble-x)
[![](https://img.shields.io/badge/源码-码云-red.svg)](https://gitee.com/fszeng/easyble-x)

## 功能
- 支持多设备同时连接
- 支持广播包解析
- 支持连接同时配对
- 支持搜索系统已连接设备
- 支持搜索器设置
- 支持自定义搜索过滤条件
- 支持自动重连、最大重连次数限制、直接重连或搜索到设备再重连控制
- 支持请求延时及发送延时设置
- 支持分包大小设置、最大传输单元设置
- 支持观察者监听或回调方式。注意：观察者监听和回调只能取其一！
- 支持使用注解@RunOn控制回调线程
- 支持设置回调或观察者的方法默认执行线程
- 支持发送设置（是否等待发送结果回调再发送下一包）
- 支持写入模式设置
- 支持设置连接的传输方式
- 支持连接超时设置

## 配置

1. 因为使用了jdk8的一些特性，需要在module的build.gradle里添加如下配置：
```
//纯java的项目
android {
	compileOptions {
		sourceCompatibility JavaVersion.VERSION_1_8
		targetCompatibility JavaVersion.VERSION_1_8
	}
}

//有kotlin的项目还需要在project的build.gradle里添加
allprojects {
    tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8

        kotlinOptions {
            jvmTarget = '1.8'
        }
    }
}
```

2. module的build.gradle中的添加依赖，自行将latestVersion修改为各自最新版本，commons-android [最新版本](https://gitee.com/fszeng/commons-android) ，同步后通常就可以用了：
```
dependencies {
	...
	implementation 'cn.wandersnail:easyble-x:latestVersion'
	implementation 'cn.wandersnail:commons-android:latestVersion'
}
```

3. 如果从jcenter下载失败。在project的build.gradle里的repositories添加内容，最好两个都加上，添加完再次同步即可。
```
allprojects {
	repositories {
		...
		mavenCentral()
		maven { url 'https://jitpack.io' }
	}
}
```

4. AndroidManifest.xml配置权限，以下权限在SDK中已配置，如想去除某些可在app的AndroidManifest声明对应权限，然后加上tools:node="remove"
```
<uses-permission android:name="android.permission.BLUETOOTH" android:maxSdkVersion="30"/>
<uses-permission android:name="android.permission.BLUETOOTH_ADMIN" android:maxSdkVersion="30"/>
<!--  ACCESS_COARSE_LOCATION在target 28以下可使用  -->
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
<!--  ACCESS_FINE_LOCATION 在target 29以上必须，否则不会有搜索结果  -->
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
<!--  BLUETOOTH_SCAN 在target 31以上必须，否则直接抛异常  -->
<uses-permission android:name="android.permission.BLUETOOTH_SCAN"/>
<!--  BLUETOOTH_CONNECT 在target 31以上必须，否则直接抛异常  -->
<uses-permission android:name="android.permission.BLUETOOTH_CONNECT" />
```

## 使用方法

### 初始化SDK

**实例化有两种方式：**

1. 使用默认方式自动构建实例，直接获取实例即可

```
//实例化并初始化
EasyBLE.getInstance().initialize(this);
```

2. 构建自定义实例，必须在EasyBLE.getInstance()之前！！

```
ScanConfiguration scanConfig = new ScanConfiguration()
		.setScanSettings(new ScanSettings.Builder()
				.setScanMode(ScanSettings.SCAN_MODE_BALANCED)//搜索模式
				.build())
		.setScanPeriodMillis(15000)//搜索周期
		.setAcceptSysConnectedDevice(true)//是否将系统蓝牙已连接的设备放到搜索结果中
		.setOnlyAcceptBleDevice(true);//是否过滤非ble设备
EasyBLE ble = EasyBLE.getBuilder().setScanConfiguration(scanConfig)
        .setScannerType(ScannerType.LE)//指定蓝牙扫描器，默认为系统Android5.0以上使用ScannerType.LE
        .setExecutorService(executorService)//自定义线程池用来执行后台任务，也可使用默认
        .setDeviceCreator(creator)//设备实例构建器。返回搜索结果时的设备对象由此构建器实例化
		.setObserveAnnotationRequired(false)//不强制使用{@link Observe}注解才会收到被观察者的消息，默认为false
		.setMethodDefaultThreadMode(ThreadMode.MAIN)//指定回调方法和观察者方法的默认线程，默认为ThreadMode.MAIN
		.build();
ble.initialize(this);
```

### 销毁SDK

```
//如果中途需要修改配置重新实例化，调用此方法后即可重新构建EasyBLE实例
EasyBLE.getInstance().destroy();
```

### 日志输出控制

```
EasyBLE.getInstance().setLogEnabled(true);//开启日志打印
```

### 蓝牙搜索

1. 定义搜索监听器

   > Android6.0以上搜索需要至少模糊定位权限，如果targetSdkVersion设置29以上需要精确定位权限。权限需要动态申请

```
private ScanListener scanListener = new ScanListener() {
	@Override
	public void onScanStart() {
		//搜索开始
	}

	@Override
	public void onScanStop() {
		//搜索停止
	}

    /**
     * 搜索到BLE设备
     *
     * @param device           搜索到的设备
     * @param isConnectedBySys 是否已被系统蓝牙连接上
     */
	@Override
	public void onScanResult(@NonNull Device device, boolean isConnectedBySys) {
		//搜索结果
	}

	@Override
	public void onScanError(int errorCode, @NotNull String errorMsg) {
		switch(errorCode) {
			case ScanListener.ERROR_LACK_LOCATION_PERMISSION://缺少定位权限		
				break;
			case ScanListener.ERROR_LOCATION_SERVICE_CLOSED://位置服务未开启		
				break;
			case ScanListener.ERROR_LACK_LOCATION_PERMISSION://缺少定位权限		
				break;
			case ScanListener.ERROR_LACK_SCAN_PERMISSION://targetSdkVersion大于等于Android12时，缺少搜索权限(发现附近设备)	
				break;
			case ScanListener.ERROR_LACK_CONNECT_PERMISSION://targetSdkVersion大于等于Android12时，缺少连接权限	
				break;	
			case ScanListener.ERROR_SCAN_FAILED://搜索失败
				break;
		}
	}
};
```
2. 添加监听

```
EasyBLE.getInstance().addScanListener(scanListener);
```
3. 开始搜索

```
EasyBLE.getInstance().startScan();
```
4. 停止搜索

```
EasyBLE.getInstance().stopScan();
```
5. 停止监听

```
EasyBLE.getInstance().removeScanListener(scanListener);
```

### 观察者模式数据及事件

1. 定义观察者。实现EventObserver接口即可：

```
public class MainActivity extends AppCompatActivity implements EventObserver {
    /**
     * 使用{@link Observe}确定要接收消息，{@link RunOn}指定在主线程执行方法，设置{@link Tag}防混淆后找不到方法
     */
    @Tag("onConnectionStateChanged") 
    @Observe
    @RunOn(ThreadMode.MAIN)
    @Override
    public void onConnectionStateChanged(@NonNull Device device) {
        switch (device.getConnectionState()) {
            case SCANNING_FOR_RECONNECTION:
                break;
            case CONNECTING:
                break;
            case DISCONNECTED:
                break;
            case SERVICE_DISCOVERED:
                break;
        }
    }
	
    /**
     * 使用{@link Observe}确定要接收消息，方法在{@link EasyBLEBuilder#setMethodDefaultThreadMode(ThreadMode)}指定的线程执行
     */
    @Observe
    @Override
    public void onNotificationChanged(@NonNull Request request, boolean isEnabled) {
        if (request.getType() == RequestType.SET_NOTIFICATION) {
            if (isEnabled) {
                Log.d("EasyBLE", "通知开启了");
            } else {
                Log.d("EasyBLE", "通知关闭了");
            }
        } else {
            if (isEnabled) {
                Log.d("EasyBLE", "Indication开启了");
            } else {
                Log.d("EasyBLE", "Indication关闭了");
            }
        }
    }

    /**
     * 如果{@link EasyBLEBuilder#setObserveAnnotationRequired(boolean)}设置为false时，无论加不加{@link Observe}注解都会收到消息。
     * 设置为true时，必须加{@link Observe}才会收到消息。
     * 默认为false，方法默认执行线程在{@link EasyBLEBuilder#setMethodDefaultThreadMode(ThreadMode)}指定
     */
    @Override
    public void onCharacteristicWrite(@NonNull Request request, @NonNull byte[] value) {
        Log.d("EasyBLE", "成功写入：" + StringUtils.toHex(value, " "));
    }
}
```

2. 注册观察者

```
EasyBLE.getInstance().registerObserver(observer);
```

3. 取消注册观察者

```
EasyBLE.getInstance().unregisterObserver(observer);
```

### 连接

1. 连接配置

```
//连接配置，举个例随意配置两项
ConnectionConfiguration config = new ConnectionConfiguration();
config.setConnectTimeoutMillis(10000);
config.setRequestTimeoutMillis(1000);
```

2. 建立连接

```
connection = EasyBLE.getInstance().connect(device, config);//观察者监听连接状态
```

3. 断开连接，还可重连

```
EasyBLE.getInstance().disconnectConnection(device);//断开指定连接
//EasyBLE.getInstance().disconnectAllConnections();//断开所有连接
```

4. 释放连接，不可重连，需要重新建立连接

```
EasyBLE.getInstance().releaseConnection(device);//释放指定连接
//EasyBLE.getInstance().releaseAllConnections();//释放所有连接
```

### 读写特征值、开启Notify

**两种方式：**

1. 接口回调方式

```
//开关通知
boolean isEnabled = connection.isNotificationOrIndicationEnabled(serviceUuid, characteristicUuid);
Request.Builder<NotificationChangeCallback> builder = Request.getSetNotificationBuilder(serviceUuid, characteristicUuid, !isEnabled);
//不设置回调，使用观察者模式接收结果
builder.build().execute(connection);

//读取特征值
Request.Builder<ReadCharacteristicCallback> builder = Request.getReadCharacteristicBuilder(serviceUuid, characteristicUuid);
builder.setTag(UUID.randomUUID().toString());
builder.setPriority(Integer.MAX_VALUE);//设置请求优先级
//设置了回调则观察者不会收到此次请求的结果消息
builder.setCallback(new ReadCharacteristicCallback() {
	//注解可以指定回调线程
	@RunOn(ThreadMode.BACKGROUND)
	@Override
	public void onCharacteristicRead(@NonNull Request request, @NonNull byte[] value) {
		Log.d("EasyBLE", "主线程：" + (Looper.getMainLooper() == Looper.myLooper()));
		Log.d("EasyBLE", "读取到特征值：" + StringUtils.toHex(value, " "));
	}

	//不使用注解指定线程的话，使用构建器设置的默认线程
	@Override
	public void onRequestFailed(@NonNull Request request, int failType, @Nullable Object value) {

	}
});
builder.build().execute(connection);

//写特征值
Request.WriteCharacteristicBuilder builder = Request.getWriteCharacteristicBuilder(serviceUuid, characteristicUuid, "test write".getBytes());
//根据需要设置写入配置
builder.setWriteOptions(new WriteOptions.Builder()
		.setPackageSize(20)
		.setPackageWriteDelayMillis(5)
		.setRequestWriteDelayMillis(10)
		.setWaitWriteResult(true)
		.setWriteType(BluetoothGattCharacteristic.WRITE_TYPE_DEFAULT)
		.build());
//不设置回调，使用观察者模式接收结果
connection.execute(builder.build());
```

2. 使用观察者模式接收结果。不在请求构建器中设置回调即可

### 释放SDK，释放后必须重新初始化后方可使用

```
EasyBLE.getInstance().release();
```
### 代码混淆
如果使用jar方式依赖，需要添加一下混淆规则。使用aar或直接远程依赖不需要额外添加，库里自带混淆规则

```
-keep class * implements cn.wandersnail.commons.observer.Observe {
	public <methods>;
}
-keep class * implements cn.wandersnail.ble.Request {
    !private *;
}
```

## Demo效果预览
![image](https://s2.ax1x.com/2020/02/29/3sWVn1.png)
![image](https://s2.ax1x.com/2020/02/29/3sWAXR.png)
![image](https://s2.ax1x.com/2020/02/29/3sWe76.gif)
